version: '3.5'

services:
  ####################### Ingestion Services #######################
  rss:
    image: tno:rss
    profiles:
      - all
      - service
      - data
    restart: "no"
    container_name: tno-rss
    build:
      context: services/syndication
    env_file:
      - services/syndication/rss.env
    ports:
      - ${SYNDICATION_RSS_PORT:-40020}:8080
    depends_on:
      - database
      - broker
    networks:
      - tno
    healthcheck:
      test: curl -s -f http://localhost:8080/health || exit 1
      interval: 1m
      timeout: 10s
      retries: 3
      start_period: 30s

  atom:
    image: tno:atom
    profiles:
      - all
      - service
      - data
    restart: "no"
    container_name: tno-atom
    build:
      context: services/syndication
    env_file:
      - services/syndication/atom.env
    ports:
      - ${SYNDICATION_ATOM_PORT:-40021}:8080
    depends_on:
      - database
      - broker
    networks:
      - tno
    healthcheck:
      test: curl -s -f http://localhost:8080/health || exit 1
      interval: 1m
      timeout: 10s
      retries: 3
      start_period: 30s

  nlp:
    image: tno:nlp
    profiles:
      - all
      - service
      - data
    restart: "no"
    container_name: tno-nlp
    build:
      context: services/nlp
    env_file:
      - services/nlp/.env
    ports:
      - ${NLP_PORT:-40022}:8080
    volumes:
      - ./services/nlp/src/main/resources/models:/app/classes/models
    depends_on:
      - database
    networks:
      - tno
    healthcheck:
      test: curl -s -f http://localhost:8080/health || exit 1
      interval: 1m
      timeout: 10s
      retries: 3
      start_period: 30s

  indexing:
    image: tno:indexing
    profiles:
      - all
      - service
      - data
      - elastic
    restart: "no"
    container_name: tno-indexing
    build:
      context: services/elastic
    env_file:
      - services/elastic/.env
    ports:
      - ${INDEXING_PORT:-40023}:8080
    depends_on:
      - database
      - elastic
    networks:
      - tno
    healthcheck:
      test: curl -s -f http://localhost:8080/health || exit 1
      interval: 1m
      timeout: 10s
      retries: 3
      start_period: 30s

  audio:
    image: tno:audio
    profiles:
      - all
      - service
      - data
    restart: "no"
    container_name: tno-audio
    build:
      context: services/audio
    env_file:
      - services/audio/audio.env
    ports:
      - ${AUDIO_PORT:-40024}:8080
    depends_on:
      - database
      - broker
    networks:
      - tno
    healthcheck:
      test: curl -s -f http://localhost:8080/health || exit 1
      interval: 1m
      timeout: 10s
      retries: 3
      start_period: 30s
